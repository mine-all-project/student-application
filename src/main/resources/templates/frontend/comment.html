<html>
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      p {
          padding: 0;
          margin: 0
      }

      .content {
          display: flex;
          flex-direction: row;
          background-color: rgb(217, 217, 217);
          overflow-y: scroll;
          height: 100vh;
      }

      .menus {
          flex: 2;
          height: 416px;
          padding: 0;
          margin: 19px 0 0 0;
          border-right: 1px solid #999999;
      }

      .menus li {
          background-color: #999999;
          color: #505050;
          font-size: 39px;
          list-style: none;
          display: flex;
          align-items: center;
          justify-content: center;
          height: 69px;
          width: 154px;

          font-family: 'Microsoft YaHei';
      }

      .ant-pagination-item-link {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
      }

      .comment-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background-color: #999999;
          color: #505050;
          /*height: 60px;*/
          margin-left: 115px;
          /*width: 376px;*/
      }

      .comment-content {
          /*width: 304px;*/
          font-size: 39px;
          text-align: center;
      }

      .comment-result {
          vertical-align: center;
          /*width: 72px;*/
          font-size: 19px;
          text-align: center;
          margin-right: 2rem;
      }

      .body-bgi {
          background-repeat: no-repeat;
          background-size: 100%;
          width: 100%;
          height: 100%;
          position: absolute;
          left: 0;
          right: 0;
          top: 0;
          bottom: 0;
          z-index: 10;
      }

      .comment-item {
          font-size: 24px;
          word-break: break-all;
      }

      .comment-item img {
          width: 300px !important;
      }

      .comment-item p {
          display: flex !important;
      }
	</style>
</head>
<body style="margin: 0;scroll: no; overflow-y: hidden">
<div style="" class="content" id="app">
	<div class="body-bgi" :style="`background-image:url(${image.settings})`"></div>
	<ul class="menus" style="z-index: 20;">
		<li>评论</li>
		<li onclick="window.history.back(-1)" style="font-size: 14px">
			<img src="/images/back.svg" style="width: 30px;">返回
		</li>
	</ul>
	<div style="flex:10;height: 100%;padding: 2rem;z-index: 20">
		<div style="margin-top: 88px">
			<a-col v-for="item in dataList" style="padding: 10px;">
				<div class="comment-item">
					<div class="comment-content" style="" v-html="item.content">评论</div>
					<div class="comment-result" @click="showResult(item)" v-if="item.recontent === ''">回复</div>
				</div>
				<br>
				<div class="comment-item" v-if="item.recontent !== ''">
					<div class="comment-content" style="" v-html="item.recontent">评论</div>
				</div>
				<div style="width: 656px;border-bottom:1px solid #999999;margin-top: 23px"></div>
			</a-col>
		</div>
		<a-modal :title="false" :visible.sync="show.result" width="30%" :footer="false" @cancel="closeRecontent">
			<a-form-model :label-col="labelCol" :wrapper-col="wrapperCol">
				<a-form-model-item label="回复" prop="username">
					<a-textarea placeholder="回复" :rows="4" v-model="recontent"></a-textarea>
				</a-form-model-item>
			</a-form-model>
			<div style="text-align: center">
				<button @click="saveRecontent">确认</button>
			</div>
		</a-modal>
	</div>
</div>
<script>
    const app = new Vue({
        el: '#app',
        components: {},
        data() {
            return {
                labelCol: {span: 5},
                wrapperCol: {span: 16},
                image: {
                    settings: '/images/settings.jpg',
                },
                axios: axios,
                userInfo: {},
                isAdmin: false,
                title: '',
                menus: [
                    {
                        key: '', show: () => {
                            return true
                        }, name: '已发布动态'
                    },
                    {
                        key: 'news', show: () => {
                            return this.isAdmin
                        }, name: '校园资讯'
                    },
                    {
                        key: 'trading', show: () => {
                            return true
                        }, name: '二手交易'
                    },
                    {
                        key: 'employment', show: () => {
                            return this.isAdmin
                        }, name: '就业速递'
                    },
                    {
                        key: 'lost-items', show: () => {
                            return true
                        }, name: '失物招领'
                    },
                    {
                        key: 'question', show: () => {
                            return true
                        }, name: '校园问答'
                    },
                    {
                        key: 'friends', show: () => {
                            return true
                        }, name: '校园交友'
                    },
                ],
                dataList: [],
                typeKey: '',
                show: {
                    result: false
                },
                recontent: '',
                temp: {
                    comment: {}
                }
            }
        },
        mounted() {
            this.getUserInfo()
            this.getList()
        },
        methods: {
            saveRecontent() {
                let data = this.temp.comment
                data.recontent = this.recontent
                console.log(data)
                axios.post(`/api/paper/comment/recomment`, data).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    this.closeRecontent()
                    this.getList()
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            closeRecontent() {
                this.show.result = false
            },
            showResult(record) {
                this.temp.comment = record
                this.show.result = true
            },
            initTitle() {
                let url = window.location.href
                let key = url.split('?key=')[1]
                switch (key) {
                    case 'other' :
                        this.title = '其他';
                        break;
                    case 'question' :
                        this.title = '校园问答';
                        break;
                    case 'friend' :
                        this.title = '校园交友';
                        break;
                    case 'car' :
                        this.title = '校园拼车';
                        break;
                }
                this.titleKey = key
                this.getList()
            },
            getList() {
                axios.get(`/api/paper/comment/list`).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.dataList = result.data
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            filterDataList(source) {
                this.dataList = source.map(e => {
                    let files = e.files.sort((a, b) => {
                        let createTimeA = new moment(a.createTime)
                        let createTimeB = new moment(b.createTime)
                        return createTimeA.diff(createTimeB, 's');
                    })
                    return {
                        id: e.id,
                        title: '题目',
                        price: e.price,
                        files: files,
                        content: e.content,
                        type: e.type,
                        messages: e.messages,
                        createTime: e.createTime,
                        createTimeStr: new moment(e.createTime).format('YYYY-MM-DD HH:mm:ss'),
                    }
                });
            },

            changePage(e) {
                console.log(e)
            },
            changeSecondType(e) {
                this.typeKey = e.key
                this.getList()
                console.log(e)
            },
            changeOtherType(e) {
                console.log(e)
            },
            getUserInfo() {
                this.axios.get('/api/user/getUserInfo').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        if (result.status === 401) {
                            window.location.href = '/frontend/login.html'
                        }
                        return;
                    }
                    if (result.data !== null) {
                        this.userInfo = result.data;
                        this.isAdmin = result.data.role === 0
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
        }
    })

</script>
</body>
</html>
