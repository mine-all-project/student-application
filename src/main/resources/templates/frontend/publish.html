<html>
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/base :: quill"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      p {
          padding: 0;
          margin: 0
      }

      .content {
          display: flex;
          flex-direction: row;
          height: max-content
      }

      .menus {
          flex: 2;
          height: 100%;
          margin: 0;
          padding: 0;
      }

      .menus li {
          background-color: #999999;
          color: #505050;
          font-size: 14px;
          list-style: none;
          display: flex;
          align-items: center;
          justify-content: center;
          height: 85px;
          font-family: 'Microsoft YaHei';
      }

      .menus li:first-child {
          font-size: 14px;
          text-align: center;
          background-repeat: no-repeat;
          background-size: auto 100%;
          background-position: center;
          background-color: #47bcbc;
      }

      .ant-pagination-item-link {
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
      }
	</style>
</head>
<body style="margin: 0;scroll: no; overflow-y: hidden">
<div style="" class="content" id="app">
	<ul class="menus">
		<li v-for="item in menus" @click="changeType(item)">{{item.name}}</li>
	</ul>
	<div style="flex:10;height: 100%;padding: 2rem">
		<p style="font-size:14px;background-color:#999999;color: #505050;width: max-content;padding: 1rem 3rem;">
			{{title}}</p>
		<div style="height: 3px;background-color:#999999;margin-top: 10px"></div>
		<div style="margin-top: 10px">
			<div v-if="editor.create">编辑器初始化中..</div>
			<div id="editor" style="height: 40vh"></div>
			<!-- Create toolbar container -->
			<div id="toolbar">
				<button class="ql-emoji"></button>
				<button class="ql-image"></button>
				<a-upload class="ql-file" name="file" action="/api/uploadFile"
									:multiple="true" :file-list="temp.fileList" :remove="removeUploadFile"
									@preview="showPreview" @change="changeUploadFile">
					<div style="display: flex;flex-direction: column;align-items: center;color: #fff">
						<a-icon type="upload"></a-icon>
						<span>上传</span>
					</div>
				</a-upload>
			</div>
		</div>
	</div>
</div>
<script>
    const app = new Vue({
        el: '#app',
        components: {},
        data() {
            return {
                headers: headers,
                pagination: {
                    pageSize: 3,
                    pageIndex: 1,
                    pageCount: 50,
                },
                title: '校园资讯',
                menus: [
                    {key: '', name: '发布动态'},
                    {key: '', name: '校园资讯'},
                    {key: '', name: '二手交易'},
                    {key: '', name: '就业速递'},
                    {key: '', name: '失物招领'},
                    {key: '', name: '校园问答'},
                    {key: '', name: '校园交友'},
                ],
                dataList: [
                    {
                        title: 'title',
                        content: 'xxxxx'
                    },
                    {
                        title: 'title',
                        content: 'xxxxx'
                    }
                ],
                editor: {
                    instance: null,
                    create: true,
                    toolbar: [
                        ['bold', 'italic', 'underline', 'strike'], //加粗，斜体，下划线，删除线
                        ['blockquote', 'code-block'],  //引用，代码块
                        [{'list': 'ordered'}, {'list': 'bullet'}],  //列表
                        [{'color': []}, {'background': []}],  // 字体颜色，字体背景颜色
                        [{'align': []}], //对齐方式
                        ['clean'], //清除字体样式
                        ['image'], //上传图片、上传视频
                        ['emoji'], //上传图片、上传视频
                    ]
                },
                temp: {
                    fileList: []
                },
            }

        },
        mounted() {
            this.initType()
            this.createEditor('')
        },
        methods: {
            /*upload*/
            changeUploadFile(info) {
                this.temp.fileList = info.fileList
                if (info.file.status === 'done') {
                    this.$message.success(`${info.file.name} 上传成功`);
                } else if (info.file.status === 'error') {
                    this.$message.error(`${info.file.name} 上传失败`);
                }
            },
            removeUploadFile(file) {
                this.temp.fileList = []
            },
            closePreview() {
                this.show.previewImg = false
            },
            async showPreview(file) {
                if (file.response) {
                    this.temp.previewSrc = file.response.data.virtualPath
                } else {
                    this.temp.previewSrc = file.url
                }
                this.show.previewImg = true
            },

            createEditor(content) {
                setTimeout(() => {
                    if (this.editor.create) {
                        this.editor.instance = new window.Quill('#editor', {
                            theme: 'snow',
                            modules: {
                                // toolbar: this.editor.toolbar,
                                toolbar: '#toolbar',
                                "emoji-toolbar": true,
                                // "emoji-shortname": true,
                                // "emoji-textarea": true
                            }
                        })
                        this.editor.create = false
                    }
                    this.editor.instance.root.innerHTML = content
                }, 1000)
            },
            destroyEditor() {
                this.editor.instance.root.innerHTML = ''
            },
            initType() {
                let url = window.location.href
                let key = url.split('?key=')[1]
                switch (key) {
                    case 'news' :
                        this.title = '校园资讯';
                        break;
                    case 'trading' :
                        this.title = '二手交易';
                        break;
                    case 'employment' :
                        this.title = '就业速递';
                        break;
                    case 'lost-items' :
                        this.title = '失物招领';
                        break;
                    case 'question' :
                        this.title = '校园问答';
                        break;
                    case 'friends' :
                        this.title = '校园交友';
                        break;
                }
                this.titleKey = key
                console.log(key)
            },
            changePage(e) {
                console.log(e)
            },
            changeType(e) {
                console.log(e.name)
            },
            handleChange(e) {
                console.log(e)
            },

        }
    })

</script>
</body>
</html>
