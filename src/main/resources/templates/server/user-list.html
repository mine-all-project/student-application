<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org"
			xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      .drawer-bottom-button {
          position: absolute;
          right: 0;
          bottom: 0;
          width: 100%;
          border-top: 1px solid #e9e9e9;
          padding: 10px 16px;
          background: #fff;
          text-align: right;
          z-index: 1;
      }
	</style>
</head>
<body>
<div id="app">
	<a-tabs type="card">
		<a-tab-pane key="1" tab="二手交易">
			<a-button @click="showAddGoods(0)">发布闲置</a-button>
			<a-divider></a-divider>
			<a-space direction="vertical"
							 style="display: flex;flex-wrap: wrap;justify-content: space-around;flex-direction: row">
				<a-card hoverable style="width: 240px" v-for="item in freeGoods">
					<img slot="cover" src="https://os.alipayobjects.com/rmsportal/QBnOOoLaAfKPirc.png"/>
					<a-card-meta title="Europe Street beat">
						<template slot="description">
							www.instagram.com
						</template>
					</a-card-meta>
				</a-card>
			</a-space>
		</a-tab-pane>
		<a-tab-pane key="2" tab="租赁">
			<a-button @click="showAddGoods(1)">发布租赁</a-button>
			<a-divider></a-divider>
			<a-space direction="vertical"
							 style="display: flex;flex-wrap: wrap;justify-content: space-around;flex-direction: row">
				<a-card hoverable style="width: 240px" v-for="item in freeGoods">
					<img slot="cover" src="https://os.alipayobjects.com/rmsportal/QBnOOoLaAfKPirc.png"/>
					<a-card-meta title="Europe Street beat">
						<template slot="description">
							www.instagram.com
						</template>
					</a-card-meta>
				</a-card>
			</a-space>
		</a-tab-pane>
		<a-button slot="tabBarExtraContent">
			发布急需
		</a-button>
	</a-tabs>
	<a-modal title="发布" :visible.sync="show.addGoods" width="25%" ok-text="确认"
					 cancel-text="取消" @ok="saveGoods" @cancel="closeAddGoods">
		<a-form-model ref="ruleForm" :model="form.goods" :rules="rules" :label-col="labelCol" :wrapper-col="wrapperCol">
			<a-form-model-item ref="name" label="商品名称" prop="name">
				<a-input v-model="form.goods.name"></a-input>
			</a-form-model-item>
			<a-form-model-item ref="image" label="商品图片" prop="image">
				<div class="clearfix">
					<a-upload name="file" list-type="picture-card" :file-list="fileList"
										action="/api/uploadFile" @preview="handlePreview" @change="changeUploadFile">
						<div v-if="fileList.length < 8">
							<a-icon type="plus"></a-icon>
							<div class="ant-upload-text"> Upload</div>
						</div>
					</a-upload>
					<a-modal :visible="previewVisible" :footer="null" @cancel="handleCancel">
						<img alt="example" style="width: 100%" :src="previewImage"/>
					</a-modal>
				</div>


				<a-upload name="file" :multiple="true" action="/api/uploadFile" :headers="headers"
									:showUploadList="false" @change="changeUploadFile">
					<a-button type="dashed" size="small" @click="uploadFile()">上传图片</a-button>
				</a-upload>
			</a-form-model-item>
		</a-form-model>
	</a-modal>

</div>
<script>
    const app = new Vue({
        el: '#app',
        data() {
            return {
                fileList: [],
                freeGoods: [{}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},],
                rules: {
                    name: [
                        {required: true, message: '请输入商品名称', trigger: 'change'},
                        {min: 8, max: 16, message: '长度为8-16位', trigger: 'change'},
                    ],
                    password: [
                        {required: true, message: '请输入新密码', trigger: 'change'},
                        {min: 8, max: 16, message: '长度为8-16位', trigger: 'change'},
                    ],
                    rePassword: [
                        {required: true, message: '请重复新密码', trigger: 'change'},
                        {min: 8, max: 16, message: '长度为8-16位', trigger: 'change'},
                    ],
                },
                labelCol: {span: 5},
                wrapperCol: {span: 16},
                form: {
                    goods: {}
                },
                show: {
                    addGoods: false,
                },
                sysUser: sessionStorage.getItem("sysUser")
            };
        },
        mounted() {
            this.getList()
            // this.getTagsList()
        },
        methods: {
            async handlePreview(file) {
                // if (!file.url && !file.preview) {
                //     file.preview = await getBase64(file.originFileObj);
                // }
                // this.previewImage = file.url || file.preview;
                // this.previewVisible = true;
            },
            changeUploadFile(info) {
                // if (info.file.status === 'done') {
                //     this.$message.success(`${info.file.name} 上传成功`);
                //     this.showAddResultInfo()
                //     this.form.addResultInfo.url = info.file.response.data.path
                //     this.form.addResultInfo.fileName = info.file.name
                // } else if (info.file.status === 'error') {
                //     this.$message.error(`${info.file.name} 上传失败`);
                // }
            },
            uploadFile() {

            },
            showAddGoods(type) {
                this.show.addGoods = true
            },
            closeAddGoods() {
                this.show.addGoods = false
            },
            saveGoods() {
                this.closeAddGoods()
            },
            refreshData() {
                this.getList()
            },
            getList() {
                axios.get('/api/user/list').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.dataSource = result.data;
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            changeStatus(e) {
                const _this = this;
                this.$confirm({
                    title: '确认操作?',
                    cancelText: '取消',
                    okText: '确定',
                    onOk() {
                        _this.form.userInfo = e
                        _this.form.userInfo.status = Math.abs(_this.form.userInfo.status - 1)
                        axios.post('/api/user/changeStatus', _this.form.userInfo).then(result => {
                            console.log('通过api获取到的数据:', result);
                            if (result.status !== 200) {
                                _this.$message.error(result.message);
                                return
                            }
                            _this.$message.success(result.message)
                        }).catch(function (error) {
                            console.log('请求出现错误:', error);
                        });
                    },
                });
            },
            removeUser(e) {
                const _this = this;
                this.$confirm({
                    title: '确认操作?',
                    cancelText: '取消',
                    okText: '确定',
                    onOk() {
                        console.log(e)
                        axios.post('/api/user/delUser', e).then(result => {
                            console.log('通过api获取到的数据:', result);
                            if (result.status !== 200) {
                                _this.$message.error(result.message);
                                return
                            }
                            _this.$message.success(result.message)
                        }).catch(function (error) {
                            console.log('请求出现错误:', error);
                        });
                    },
                });
            },
            addUser() {
                this.form.type = 0
                this.show.userInfo = true
            },
            editUser(e) {
                this.form.type = 1
                this.form.userInfo.id = e.id
                this.form.userInfo.username = e.username
                this.form.userInfo.password = e.password
                this.form.userInfo.name = e.name
                this.form.userInfo.age = e.age
                this.form.userInfo.mail = e.mail
                this.form.userInfo.role = e.role + ''
                this.form.userInfo.status = e.status
                // this.form.userInfo.tags = e.tags.map(r => {
                //     return r.id
                // })
                console.log(this.form.userInfo.role)
                this.show.userInfo = true
            },
            closeUserForm() {
                this.form.userInfo = {
                    id: '',
                    name: '',
                    age: '',
                    mail: '',
                    role: null,
                    status: null,
                    tags: [],
                }
                this.show.userInfo = false
                this.refreshData()
            },
            saveUserForm() {
                console.log(this.form)
                let url = this.form.type === 0 ? '/api/user/addUser' : '/api/user/editUser'
                axios.post(url, this.form.userInfo).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    this.closeUserForm()
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            closeResetPassword() {
                this.show.resetPassword = false
            },
            showResetPassword(e) {
                this.form.resetPassword.id = e.id
                this.show.resetPassword = true
            },
            submitResetPassword() {
                console.log(this.form.resetPassword)
                axios.post('/api/user/resetPassword', this.form.resetPassword).then(result => {
                    console.log('通过api获取到的数据:', result);
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return
                    }
                    this.$message.success(result.message)
                }).catch(function (error) {
                    console.log('请求出现错误:', error);
                });
            },
        }
    })
</script>
</body>
</html>
