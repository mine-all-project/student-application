<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org"
			xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<title>用户登陆</title>
</head>
<body class="login-bg">
<div class="login layui-anim layui-anim-up">
	<div class="message">用户注册</div>
	<div id="darkbannerwrap"></div>
	<form method="post" class="layui-form" id="app">
		<input name="username"  lay-verify="required" class="layui-input" placeholder="用户名" type="text"
					 v-model="username">
		<hr class="hr15"/>
		<input name="password"  lay-verify="required" class="layui-input" placeholder="密码"
					 type="password" v-model="password">
		<hr class="hr15"/>
		<input name="againPassword"  lay-verify="required" class="layui-input" placeholder="重复密码"
					 type="password" v-model="againPassword">
		<hr class="hr15"/>
		<input name="name"  lay-verify="required" class="layui-input" placeholder="姓名" type="text"
					 v-model="name">
		<hr class="hr15"/>
		<input name="age"  lay-verify="required" class="layui-input" placeholder="年龄"
					 type="number" v-model="age">
		<hr class="hr15"/>
		<input @click="register" style="width:100%;" type="button" value="注册">
	</form>
</div>
<script th:src="@{/js/jquery-1.8.2.min.js}"></script>
<link rel="stylesheet" th:href="@{/css/login-01/login.css}">
<div th:replace="/components/vue :: javascript"></div>
<div th:replace="/components/base :: javascript"></div>
<div th:replace="/components/ui :: antd"></div>
<div th:replace="/components/lay-ui :: javascript"></div>
<div th:replace="/components/lay-ui :: x-admin"></div>
<script>
    function initLayui() {
        layui.use('form', function () {
            let form = layui.form;
            form.on('submit(register)', function (data) {
                vue.register()
            });
        });
    }

    let vue = new Vue({
        el: '#app',
        data() {
            return {
                username: '',
                password: '',
                againPassword: '',
                name: '',
                age: '',
            }
        },
        mounted() {
            initLayui()
        },
        methods: {
            register() {
                if (this.password !== this.againPassword) {
                    this.$message.error('两次密码不一致')
                    return
                }
                let data = {
                    username: this.username,
                    password: this.password,
                    againPassword: this.againPassword,
                    name: this.name,
                    age: this.age,
                    role: 2,
                }
                console.log('data--->', data)
                axios.post('/api/registry', data).then(response => {
                    const result = response.data
                    console.log('通过api获取到的数据:', result)
                    if (result.status !== 200) {
                        layer.msg(result.message)
                        return
                    }
                    layer.msg(result.message)
                    setTimeout(() => {
                        window.location.href = '/server/login'
                    }, 2000)
                }).catch(exception => {
                    layer.msg('系统错误')
                    console.error('系统错误', exception)
                })
            }
        }
    })
</script>
</body>
</html>
