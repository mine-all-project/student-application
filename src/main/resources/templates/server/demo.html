<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org"
			xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      .drawer-bottom-button {
          position: absolute;
          right: 0;
          bottom: 0;
          width: 100%;
          border-top: 1px solid #e9e9e9;
          padding: 10px 16px;
          background: #fff;
          text-align: right;
          z-index: 1;
      }

      .ant-input-number {
          width: 100%;
      }
	</style>
</head>
<body>
<div id="app">
	<a-row>
		<a-col :span="6">
			<a-input placeholder="输入关键字搜索" v-model="form.searchText"></a-input>
		</a-col>
		<a-col :span="6" style="display: flex;justify-content: space-around">
			<a-button type="primary" @click="search">搜索</a-button>
			<a-button @click="resetList">重置</a-button>
			<a-button @click="showAddOrder">添加账单</a-button>
		</a-col>
	</a-row>
	<a-divider></a-divider>
	<a-tabs type="card">
		<a-tab-pane key="1" tab="全部账单">
			<a-table :columns="columns.order" :data-source="tableDataList.allOrder" rowKey="id" :pagination="false">
				<span slot="indexNum" slot-scope="text">{{ text + 1 }}</span>
				<span slot="content" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="publisher" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text.username }}</span>
            </template>
            <span class="step-content">{{ text.username }}</span>
          </a-tooltip>
        </span>
				<span slot="createTime" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="note" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="type" slot-scope="text">
						<a-tag color="green" v-if="text === 1">闲置</a-tag>
						<a-tag color="blue" v-if="text === 2">租赁</a-tag>
				</span>
				<span slot="status" slot-scope="text">
          <a-tag color="green" v-if="text === 0">正常</a-tag>
          <a-tag color="blue" v-if="text === 1">待审</a-tag>
          <a-tag color="red" v-if="text === 2">驳回</a-tag>
				</span>
				<span slot="action" slot-scope="text, record">
					<a-button type="danger" size="small" @click="deleteOrder(record)">删除</a-button>
					<a-button type="danger" size="small" @click="showChangeGoodsStatus(record,2)">驳回</a-button>
					<a-button type="default" size="small" @click="showGoodsInfo(record)">查看详情</a-button>
      	</span>
			</a-table>
		</a-tab-pane>
		<a-tab-pane key="2" tab="已缴费">
			<a-table :columns="columns.order" :data-source="tableDataList.allOrder" rowKey="id" :pagination="false">
				<span slot="indexNum" slot-scope="text">{{ text + 1 }}</span>
				<span slot="content" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="publisher" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text.username }}</span>
            </template>
            <span class="step-content">{{ text.username }}</span>
          </a-tooltip>
        </span>
				<span slot="createTime" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="note" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="type" slot-scope="text">
						<a-tag color="green" v-if="text === 1">闲置</a-tag>
						<a-tag color="blue" v-if="text === 2">租赁</a-tag>
				</span>
				<span slot="status" slot-scope="text">
          <a-tag color="green" v-if="text === 0">正常</a-tag>
          <a-tag color="blue" v-if="text === 1">待审</a-tag>
          <a-tag color="red" v-if="text === 2">驳回</a-tag>
				</span>
				<span slot="action" slot-scope="text, record">
					<a-button type="primary" size="small" @click="showChangeGoodsStatus(record,0)">通过</a-button>
					<a-button type="danger" size="small" @click="showChangeGoodsStatus(record,2)">驳回</a-button>
					<a-button type="default" size="small" @click="showGoodsInfo(record)">查看详情</a-button>
      	</span>
			</a-table>
		</a-tab-pane>
		<a-tab-pane key="3" tab="未缴费">
			<a-table :columns="columns.order" :data-source="tableDataList.allOrder" rowKey="id" :pagination="false">
				<span slot="indexNum" slot-scope="text">{{ text + 1 }}</span>
				<span slot="content" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="publisher" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text.username }}</span>
            </template>
            <span class="step-content">{{ text.username }}</span>
          </a-tooltip>
        </span>
				<span slot="createTime" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="note" slot-scope="text">
          <a-tooltip placement="topLeft">
            <template slot="title">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
				<span slot="type" slot-scope="text">
						<a-tag color="green" v-if="text === 1">闲置</a-tag>
						<a-tag color="blue" v-if="text === 2">租赁</a-tag>
				</span>
				<span slot="status" slot-scope="text">
          <a-tag color="green" v-if="text === 0">正常</a-tag>
          <a-tag color="blue" v-if="text === 1">待审</a-tag>
          <a-tag color="red" v-if="text === 2">驳回</a-tag>
				</span>
				<span slot="action" slot-scope="text, record">
					<a-button type="primary" size="small" @click="showChangeGoodsStatus(record,0)">通过</a-button>
					<a-button type="danger" size="small" @click="showChangeGoodsStatus(record,2)">驳回</a-button>
					<a-button type="default" size="small" @click="showGoodsInfo(record)">查看详情</a-button>
      	</span>
			</a-table>
		</a-tab-pane>
	</a-tabs>
	<a-modal title="添加账单" :visible.sync="show.addOrder" width="30%" ok-text="确认"
					 cancel-text="取消" @ok="saveOrder" @cancel="closeAddOrder">
		<a-form-model ref="ruleForm" :model="form.goods" :rules="rules" :label-col="labelCol" :wrapper-col="wrapperCol">
			<a-form-model-item label="商品名称" prop="name">
				<a-input v-model="form.goods.name"></a-input>
			</a-form-model-item>
			<a-form-model-item label="商品价格" prop="price">
				<a-input-number :min="0" v-model="form.goods.price" style></a-input-number>
			</a-form-model-item>
			<a-form-model-item label="账单类型" prop="type">
				<a-radio-group name="type" v-model="form.goods.type">
					<a-radio :value="1">闲置</a-radio>
					<a-radio :value="2">租赁</a-radio>
				</a-radio-group>
			</a-form-model-item>
			<a-form-model-item label="商品描述" prop="content">
				<a-textarea v-model="form.goods.content" :rows="4"></a-textarea>
			</a-form-model-item>
		</a-form-model>
	</a-modal>
</div>
<script>
    const app = new Vue({
        el: '#app',
        data() {
            return {
                headers: headers,
                demands: [],
                columns: {
                    order: [
                        {
                            dataIndex: 'name',
                            title: '名称',
                            width: '10%'
                        },
                        {
                            dataIndex: 'price',
                            title: '价格',
                            width: '10%'
                        },
                        {
                            dataIndex: 'content',
                            title: '描述',
                            scopedSlots: {customRender: 'content'},
                            ellipsis: true,
                            width: '20%'
                        },
                        {
                            dataIndex: 'type',
                            title: '类型',
                            scopedSlots: {customRender: 'type'},
                            width: '10%'
                        },
                        {
                            dataIndex: 'status',
                            title: '状态',
                            scopedSlots: {customRender: 'status'},
                            width: '10%'
                        },
                        {
                            dataIndex: 'publisher',
                            title: '发布人',
                            scopedSlots: {customRender: 'publisher'},
                            width: '10%'
                        },
                        {
                            dataIndex: 'createTimeStr',
                            title: '发布时间',
                            scopedSlots: {customRender: 'createTime'},
                            width: '10%'
                        },
                        {
                            dataIndex: 'note',
                            title: '操作备注',
                            scopedSlots: {customRender: 'note'},
                            ellipsis: true,
                            width: '10%'
                        },
                        {
                            dataIndex: 'action',
                            title: '操作',
                            scopedSlots: {customRender: 'action'},
                            width: '20%'
                        },
                    ],
                },
                tableDataList: {
                    allOrder: [],
                },
                rules: {
                    name: [
                        {required: true, message: '请输入商品名称', trigger: 'change'},
                        {min: 1, max: 16, message: '长度为1-16位', trigger: 'change'},
                    ],
                    price: [
                        {required: true, message: '请输入商品价格', trigger: 'change'},
                    ],
                    title: [
                        {required: true, message: '请输入标题', trigger: 'change'},
                    ],
                    type: [
                        {required: true, message: '请选择发布类型', trigger: 'change'},
                    ],
                },
                labelCol: {span: 5},
                wrapperCol: {span: 16},
                form: {
                    order: {},
                    searchText: '',
                },
                show: {
                    previewImg: false,
                    addGoods: false,
                    addDemand: false,
                    goodsInfo: false,
                    demandInfo: false,
                    goodsMessage: false,
                    demandMessage: false,
                },
                temp: {
                    previewSrc: '',
                    fileList: [],
                    allGoods: [],
                    searchGoods: [],
                    messages: [],
                    message: '',
                    isAddGoods: false,
                    isAddDemand: false,
                    isMinePublish: false,
                },
                sysUser: sessionStorage.getItem("sysUser")
            };
        },
        mounted() {
            this.getList()
        },
        methods: {
            showAddOrder() {
                this.form.order = {}
                this.show.addOrder = true
            },
            closeAddOrder() {
                this.show.addOrder = false
                this.form.order = {}
            },
            saveOrder() {
                let data = this.form.order
                axios.post('/api/order/save', data).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    this.$message.success(result.message);
                    this.closeAddOrder()
                    this.getList()
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            editGoods() {
                this.show.addGoods = true
                this.show.goodsInfo = false
                this.temp.isAddGoods = false
            },
            deleteOrder(record) {
                axios.delete(`/api/order/delete/${record.id}`).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    this.getList()
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            resetList() {
                this.temp.search = ''
                this.getList()
            },
            search() {
                axios.get(`/api/goods/search/${this.form.searchText}`).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.filterGoods(result.data)
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            getList() {
                axios.get('/api/order/list').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.filterList(result.data)
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            filterList(source) {
                const dataList = source.map(e => {
                    return {
                        id: e.id,
                        status: e.status,
                        note: e.note,
                        name: e.name,
                        price: e.price,
                        content: e.content,
                        type: e.type,
                        messages: e.messages,
                        createTime: e.createTime,
                        createTimeStr: new moment(e.createTime).format('YYYY-MM-DD HH:mm:ss'),
                    }
                });
                this.tableDataList.addOrder = dataList
                this.tableDataList.addOrder = dataList.filter(e => e.type === 1)
                this.tableDataList.addOrder = dataList.filter(e => e.type === 1)
            },
        }
    })
</script>
</body>
</html>
