<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org"
			xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      .drawer-bottom-button {
          position: absolute;
          right: 0;
          bottom: 0;
          width: 100%;
          border-top: 1px solid #e9e9e9;
          padding: 10px 16px;
          background: #fff;
          text-align: right;
          z-index: 1;
      }
	</style>
</head>
<body>
<div id="app">
	<div>
		<a-table :data-source="dataSource" rowKey="id" :columns="columns" :pagination="false">
      <span slot="user" slot-scope="user,record">
        <span>{{user.name}}</span>
      </span>
			<span slot="symptoms" slot-scope="text,record">
          <a-tooltip placement="topLeft">
            <template slot="text">
              <span>{{ text }}</span>
            </template>
            <span class="step-content">{{ text }}</span>
          </a-tooltip>
        </span>
		</a-table>
	</div>
</div>
<script>
    const app = new Vue({
        el: '#app',
        data() {
            return {
                columns: [
                    {
                        dataIndex: 'user',
                        title: '姓名',
                        key: 'user',
                        scopedSlots: {customRender: 'user'}
                    },
                    {
                        dataIndex: 'value',
                        title: '体温℃',
                        key: 'value',
                    },
                    {
                        dataIndex: 'phone',
                        title: '联系电话',
                        key: 'phone',
                    },
                    {
                        dataIndex: 'symptoms',
                        title: '症状',
                        scopedSlots: {customRender: 'symptoms'}
                    },
                    {
                        dataIndex: 'createTime',
                        title: '登记时间',
                        key: 'createTime',
                    },
                ],
                dataSource: [],
                labelCol: {span: 5},
                wrapperCol: {span: 16},
                tagsOptions: [],
                form: {
                    type: 0,
                    userInfo: {
                        id: '',
                        name: '',
                        age: '',
                        mail: '',
                        role: 1,
                        status: null,
                    },
                    resetPassword: {
                        id: '',
                        newPassword: '',
                        againPassword: '',
                    },
                },
                show: {
                    userInfo: false,
                },
                temperatureError: 0,
                sysUser: sessionStorage.getItem("sysUser")
            };
        },
        mounted() {
            this.getTemperatureError()
        },
        methods: {
            getTemperatureError() {
                axios.get('/api/custom/get/temperatureError').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.temperatureError = result.data
                        this.getList()
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            refreshData() {
                this.getList()
            },
            getList() {
                axios.get('/api/temperature/list').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        let dataSource = result.data.map(e => {
                            return {
                                id: e.id,
                                user: e.user,
                                phone: e.phone,
                                value: e.value,
                                symptoms: e.symptoms,
                                createTimeStr: new moment(e.createTime).format('YYYY-MM-DD HH:mm:ss'),
                            }
                        }).filter(e => {
                            console.log(e.value >= this.temperatureError, e.value, this.temperatureError)
                            return e.value >= this.temperatureError
                        })
                        this.dataSource = dataSource;
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
        }
    })
</script>
</body>
</html>
