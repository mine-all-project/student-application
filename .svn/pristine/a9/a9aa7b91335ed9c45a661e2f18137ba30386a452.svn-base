<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="renderer" content="webkit">
<title></title>
<link rel="stylesheet" href="css/pintuer.css">
<link rel="stylesheet" href="css/admin.css">
<script src="js/jquery.js"></script>
<script src="js/pintuer.js"></script>
</head>
<body>
<form method="post" action="" id="listform">
  	<div class="panel admin-panel">
    <div class="panel-head"><strong class="icon-reorder">任务列表</strong></div>
    <table class="table table-hover text-center">
      <tr>
        <th>任务编号</th>
        <th>任务名称</th>
        <th>任务简介</th>
        <th>执行人员</th>
        <th>任务赏金</th>
        <th>发布时间</th>
        <th>任务状态</th>
        <th>拒绝原因</th>
        <th>操作</th>
        <th>附件</th>
      </tr>
      <tbody data-th-each="model : ${works}">
        <tr>  
          <td data-th-text="${model.number}"></td>
          <td data-th-text="${model.name}"></td>
          <td data-th-text="${model.info}"></td>
          <td data-th-text="${model.userName}"></td>
          <td data-th-text="${model.money}"></td>
          <td data-th-text="${model.insert_time}"></td>
          <td data-th-if="${model.status==1}" style="color:#00CC99;">工作中</td>
          <td data-th-if="${model.status==2}" style="color:blue">待审核</td>
          <td data-th-if="${model.status==3}" >已结束</td>
          <td data-th-if="${model.status==4}" >已终止</td>
          <td data-th-if="${model.status==5}" >不合格</td>
          <td data-th-if="${model.status < 0 || model.status > 5}">未知</td>
          <td data-th-if="${model.status==5}" data-th-text="${model.why}"></td>
          <td data-th-if="${model.status!=5}" >无</td>
          <td>
          	<div class="button-group" data-th-value="${model.id}">
          		<a data-th-if="${model.status==1 || model.status==5}" class="button border-green" onclick="subWork(this);" style="padding: 4px 8px;">立即提交</a>
          		<a data-th-if="${model.status!=1 && model.status!=5}" class="button" href="javascript:void(0);" style="padding: 4px 8px;">禁止操作</a>
          	</div>
          </td>
           <td>
           		<!-- <input type="file" value="点击上传" class="file"/> -->
           		<input data-th-if="${model.status==1 || model.status==5}" type="file" value="点击上传" class="file"/>
           		<input type="hidden" />
           		<a data-th-if="${model.status!=1 && model.status!=5}" class="button" data-th-href="'/file/'+${model.file}" data-th-download="${model.file}" style="padding: 4px 8px;">点击下载</a>
           </td>
        </tr>
       </tbody>
    </table>
  </div>
</form>
<script>
$(function (){
	$('.file').change(function(){
		var that = this;
		var file = this.files[0];
        var formData = new FormData();
        formData.append("file",file);
		$.ajax({
            type: "POST",
            url: "/wskjglxt/fileUpload",
            data:formData,
			processData : false, 
			contentType : false, 
			dataType: "text",
            success: 
           	 function(e){
            	$(that).next().val(e);
                }
        }); 
	});
})
	function subWork(e){
		var id = $($(e).parent()[0]).attr('value');
		var file = $($($(e).parent()[0]).parent()[0]).next().children()[1].value;
		alert(file);
			 $.ajax({
	             type: "GET",
	             url: "/wskjglxt/subWork",
	             data: {
	            	 id:id,
	            	 file:file
	            	 },
	             dataType: "text",
	             success: 
	            	 function(){
	            	 	window.location.reload();
	                  }
	         });
	}
</script>
</body>
</html>