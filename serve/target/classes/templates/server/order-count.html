<!doctype html>
<html class="x-admin-sm" xmlns:th="http://www.thymeleaf.org"
			xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<div data-th-replace="/components/base :: javascript"></div>
	<div data-th-replace="/components/base :: echarts"></div>
	<div data-th-replace="/components/vue :: javascript"></div>
	<div data-th-replace="/components/ui :: antd"></div>
	<style>
      .drawer-bottom-button {
          position: absolute;
          right: 0;
          bottom: 0;
          width: 100%;
          border-top: 1px solid #e9e9e9;
          padding: 10px 16px;
          background: #fff;
          text-align: right;
          z-index: 1;
      }

      .ant-input-number {
          width: 100%;
      }
	</style>
</head>
<body>
<div id="app">
	<a-row>
		<a-col :span="6">
			<a-range-picker
					:placeholder="['开始时间', '结束时间']" v-model="form.dates"></a-range-picker>
		</a-col>
		<a-col :span="6" style="display: flex;justify-content: space-around">
			<a-button type="primary" @click="search">查询</a-button>
		</a-col>
	</a-row>
	<a-divider></a-divider>
	<a-tabs type="card">
		<a-tab-pane key="1" tab="账务统计">
			<a-col style="display: flex;justify-content: space-around">
				<div id="chart-01" style="width: 600px;height:400px;"></div>
				<div id="chart-02" style="width: 600px;height:400px;"></div>
			</a-col>
		</a-tab-pane>
	</a-tabs>
</div>
<script>
    const app = new Vue({
        el: '#app',
        data() {
            return {
                headers: headers,
                options: {person: []},
                labelCol: {span: 5},
                wrapperCol: {span: 16},
                form: {
                    dates: [],
                },
                echarts: [
                    {
                        instance: null,
                        option: {
                            legend: {},
                            xAxis: [
                                {type: 'category', data: ['全部', '已缴费', '未缴费', '逾期']}
                            ],
                            yAxis: [{}],
                            series: [
                                {
                                    name: '账单金额',
                                    type: 'bar',
                                    label: {show: true},
                                    data: [200, 170, 240, 244]
                                },
                                {
                                    name: '帐单数',
                                    type: 'bar',
                                    label: {show: true},
                                    data: [320, 302, 341, 374]
                                }
                            ]
                        }
                    },
                    {
                        instance: null,
                        option: {
                            tooltip: {
                                trigger: 'item',
                                formatter: '{a} <br/>{b} : ￥{c}元 ({d}%)'
                            },
                            legend: {
                                orient: 'vertical',
                                left: 'left',
                                data: ['已缴费', '未缴费', '逾期']
                            },
                            series: [
                                {
                                    name: '缴费情况',
                                    type: 'pie',
                                    data: [
                                        {value: 310, name: '已缴费'},
                                        {value: 234, name: '未缴费'},
                                        {value: 135, name: '逾期'},
                                    ]
                                }
                            ]
                        }
                    }
                ],
                sysUser: sessionStorage.getItem("sysUser")
            };
        },
        mounted() {
        },
        methods: {
            initEcharts() {
                this.echarts[0].instance = window.echarts.init(document.getElementById('chart-01'));
                this.echarts[0].instance.setOption(this.echarts[0].option);
                this.echarts[1].instance = window.echarts.init(document.getElementById('chart-02'));
                this.echarts[1].instance.setOption(this.echarts[1].option);
            },
            search() {
                let beginTime = new moment(this.form.dates[0]).format('YYYY-MM-DD HH:mm:ss')
                let endTime = new moment(this.form.dates[1]).format('YYYY-MM-DD HH:mm:ss')
                axios.get(`/api/order/searchDate/${beginTime}/${endTime}`).then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.filterList(result.data)
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            getList() {
                axios.get('/api/order/list').then(response => {
                    const result = response.data
                    if (result.status !== 200) {
                        this.$message.error(result.message);
                        return;
                    }
                    if (result.data !== null) {
                        this.filterList(result.data)
                    }
                }).catch(function (error) {
                    console.error('出现错误:', error);
                });
            },
            filterList(source) {
                let passOrder = source.filter(e => e.status === 0)
                let waitOrder = source.filter(e => e.status === 1)
                let failOrder = source.filter(e => e.status === 2)
                let orderPrice = [this.countPrice(source), this.countPrice(passOrder), this.countPrice(waitOrder), this.countPrice(failOrder)]
                let orderCount = [source.length, passOrder.length, waitOrder.length, failOrder.length]
                this.echarts[0].option.series[0].data = orderPrice
                this.echarts[0].option.series[1].data = orderCount
                this.echarts[1].option.series[0].data[0].value = this.countPrice(passOrder)
                this.echarts[1].option.series[0].data[1].value = this.countPrice(waitOrder)
                this.echarts[1].option.series[0].data[2].value = this.countPrice(failOrder)
                this.initEcharts()
            },
            countPrice(list) {
                let count = 0
                list.forEach(e => {
                    count += e.price
                })
                return count
            }
        }
    })
</script>
</body>
</html>
